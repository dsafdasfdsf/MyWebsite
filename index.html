<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Money Game with Cats & Admin Panel</title>
<style>
  * {
    box-sizing: border-box;
  }
  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: #f5f7fa;
    margin: 0; padding: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
    min-height: 100vh;
    overflow-x: hidden;
  }
  #topBar {
    width: 100%;
    background: #222;
    color: white;
    padding: 10px 0;
    text-align: center;
    position: sticky;
    top: 0;
    z-index: 1000;
  }
  #topBar button {
    background: #444;
    border: none;
    color: white;
    margin: 0 10px;
    padding: 8px 15px;
    border-radius: 12px;
    cursor: pointer;
    font-weight: 600;
    transition: background 0.3s ease;
  }
  #topBar button:hover {
    background: #666;
  }
  #topBar button.logoutBtn {
    background: #d9534f;
  }
  #topBar button.logoutBtn:hover {
    background: #c9302c;
  }

  #mainContent {
    display: flex;
    width: 95%;
    max-width: 1200px;
    margin-top: 20px;
    gap: 20px;
    flex-wrap: wrap;
    justify-content: center;
  }

  /* Admin Panel */
  #adminPanel {
    background: white;
    border-radius: 15px;
    box-shadow: 0 0 15px rgba(0,0,0,0.1);
    padding: 20px;
    width: 350px;
    min-height: 500px;
    display: none;
    flex-direction: column;
    gap: 20px;
    color: #333;
    animation: fadeIn 0.5s ease forwards;
  }
  #adminPanel h2 {
    margin: 0 0 10px;
    text-align: center;
    color: #222;
  }
  #playersList {
    flex-grow: 1;
    overflow-y: auto;
    border: 1px solid #ccc;
    border-radius: 10px;
    padding: 8px;
    font-size: 14px;
    max-height: 200px;
  }
  #playersList div {
    padding: 5px 8px;
    border-radius: 10px;
    cursor: pointer;
    user-select: none;
    transition: background 0.3s ease;
  }
  #playersList div.selected {
    background: #007bff;
    color: white;
  }
  #playersList div:hover:not(.selected) {
    background: #e1e7f8;
  }

  #banBtn {
    background: #d9534f;
    border: none;
    padding: 10px;
    color: white;
    font-weight: 700;
    border-radius: 12px;
    cursor: pointer;
    transition: background 0.3s ease;
  }
  #banBtn:hover {
    background: #c9302c;
  }

  #logs {
    background: #f0f0f0;
    border-radius: 10px;
    padding: 10px;
    font-size: 13px;
    max-height: 150px;
    overflow-y: auto;
    color: #444;
  }

  /* Center panel - game and cats */
  #gamePanel {
    flex: 1;
    min-width: 300px;
    max-width: 700px;
    background: white;
    border-radius: 15px;
    box-shadow: 0 0 15px rgba(0,0,0,0.1);
    padding: 20px;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 20px;
  }

  #moneyDisplay {
    font-size: 2rem;
    font-weight: 700;
    color: #333;
  }

  #timerDisplay {
    font-size: 1.2rem;
    color: #555;
  }

  /* Cats container */
  #catsContainer {
    width: 100%;
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    justify-content: center;
  }

  #catsContainer img {
    width: 80px;
    height: 80px;
    object-fit: cover;
    border-radius: 15px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.15);
    transition: transform 0.3s ease;
  }
  #catsContainer img:hover {
    transform: scale(1.1) rotate(5deg);
  }

  /* Login/SignIn modals */
  .modalOverlay {
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0,0,0,0.5);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 1100;
  }
  .modal {
    background: white;
    padding: 25px 30px;
    border-radius: 15px;
    box-shadow: 0 0 20px rgba(0,0,0,0.25);
    min-width: 320px;
    max-width: 90%;
    animation: slideDown 0.4s ease forwards;
  }
  .modal h2 {
    margin: 0 0 20px;
    color: #222;
    text-align: center;
  }
  .modal label {
    display: block;
    margin: 10px 0 5px;
    font-weight: 600;
    color: #333;
  }
  .modal input {
    width: 100%;
    padding: 8px 10px;
    border-radius: 10px;
    border: 1px solid #ccc;
    font-size: 1rem;
    transition: border-color 0.3s ease;
  }
  .modal input:focus {
    outline: none;
    border-color: #007bff;
  }
  .modal button {
    margin-top: 20px;
    width: 100%;
    padding: 10px;
    border: none;
    border-radius: 15px;
    background: #007bff;
    color: white;
    font-weight: 700;
    font-size: 1.1rem;
    cursor: pointer;
    transition: background 0.3s ease;
  }
  .modal button:hover {
    background: #0056b3;
  }
  .modal .closeBtn {
    background: #dc3545;
    margin-top: 10px;
  }
  .modal .closeBtn:hover {
    background: #a71d2a;
  }

  /* Ban popup */
  #banPopup .modal {
    max-width: 300px;
    text-align: center;
  }
  #banPopup h2 {
    color: #d9534f;
  }

  /* Animations */
  @keyframes fadeIn {
    from {opacity: 0; transform: translateY(10px);}
    to {opacity: 1; transform: translateY(0);}
  }
  @keyframes slideDown {
    from {opacity: 0; transform: translateY(-20px);}
    to {opacity: 1; transform: translateY(0);}
  }

  /* Responsive */
  @media (max-width: 900px) {
    #mainContent {
      flex-direction: column;
      align-items: center;
    }
    #adminPanel {
      width: 90%;
      max-width: 400px;
    }
    #gamePanel {
      max-width: 100%;
    }
  }
</style>
</head>
<body>

<div id="topBar">
  <button id="loginBtn">Log In</button>
  <button id="signInBtn">Sign Up</button>
  <button id="logoutBtn" class="logoutBtn" style="display:none;">Logout</button>
</div>

<div id="mainContent">
  <div id="adminPanel">
    <h2>Admin Panel</h2>
    <div>
      <label><strong>Players List</strong></label>
      <div id="playersList"></div>
    </div>
    <button id="banBtn">Ban Player</button>
    <div>
      <label><strong>Logs</strong></label>
      <div id="logs"></div>
    </div>
  </div>

  <div id="gamePanel">
    <div id="moneyDisplay">Money: $0</div>
    <div id="timerDisplay">Next +1 money in: 30s</div>
    <div id="catsContainer"></div>
  </div>
</div>

<!-- Login Modal -->
<div id="loginModal" class="modalOverlay">
  <div class="modal">
    <h2>Log In</h2>
    <label for="loginUsername">Username</label>
    <input type="text" id="loginUsername" autocomplete="username" />
    <label for="loginPassword">Password</label>
    <input type="password" id="loginPassword" autocomplete="current-password" />
    <button id="loginSubmitBtn">Log In</button>
    <button class="closeBtn" id="loginCloseBtn">Cancel</button>
  </div>
</div>

<!-- Sign Up Modal -->
<div id="signInModal" class="modalOverlay">
  <div class="modal">
    <h2>Sign Up</h2>
    <label for="signInUsername">Username</label>
    <input type="text" id="signInUsername" autocomplete="username" />
    <label for="signInPassword">Password</label>
    <input type="password" id="signInPassword" autocomplete="new-password" />
    <button id="signInSubmitBtn">Sign Up</button>
    <button class="closeBtn" id="signInCloseBtn">Cancel</button>
  </div>
</div>

<!-- Ban Popup -->
<div id="banPopup" class="modalOverlay">
  <div class="modal">
    <h2>Banned!</h2>
    <p>You have been banned by the admin.</p>
  </div>
</div>

<script>
(() => {
  // Utility: sleep
  const sleep = ms => new Promise(res => setTimeout(res, ms));

  // Elements
  const loginBtn = document.getElementById('loginBtn');
  const signInBtn = document.getElementById('signInBtn');
  const logoutBtn = document.getElementById('logoutBtn');

  const loginModal = document.getElementById('loginModal');
  const signInModal = document.getElementById('signInModal');
  const banPopup = document.getElementById('banPopup');

  const loginCloseBtn = document.getElementById('loginCloseBtn');
  const signInCloseBtn = document.getElementById('signInCloseBtn');

  const loginSubmitBtn = document.getElementById('loginSubmitBtn');
  const signInSubmitBtn = document.getElementById('signInSubmitBtn');

  const loginUsername = document.getElementById('loginUsername');
  const loginPassword = document.getElementById('loginPassword');
  const signInUsername = document.getElementById('signInUsername');
  const signInPassword = document.getElementById('signInPassword');

  const moneyDisplay = document.getElementById('moneyDisplay');
  const timerDisplay = document.getElementById('timerDisplay');
  const catsContainer = document.getElementById('catsContainer');

  const adminPanel = document.getElementById('adminPanel');
  const playersList = document.getElementById('playersList');
  const banBtn = document.getElementById('banBtn');
  const logsDiv = document.getElementById('logs');

  // Data storage keys
  const USERS_KEY = 'moneyGame_users';
  const BANNED_KEY = 'moneyGame_bannedUsers';

  // Hardcoded admin user:
  const ADMIN_USERNAME = 'admin';
  const ADMIN_PASSWORD = 'admin123';

  // State variables
  let currentUser = null; // {username, money, isAdmin}
  let users = {}; // username -> {password, money, isBanned}
  let bannedUsers = new Set();

  let logs = [];
  let selectedPlayerForBan = null;
  let moneyInterval = null;
  let moneyCountdown = 30;

  // Load data from localStorage or initialize
  function loadData() {
    const storedUsers = localStorage.getItem(USERS_KEY);
    users = storedUsers ? JSON.parse(storedUsers) : {};

    const storedBans = localStorage.getItem(BANNED_KEY);
    bannedUsers = storedBans ? new Set(JSON.parse(storedBans)) : new Set();

    // Ensure admin user exists
    if(!users[ADMIN_USERNAME]) {
      users[ADMIN_USERNAME] = {password: ADMIN_PASSWORD, money: 0, isBanned: false};
      saveUsers();
    }
  }

  function saveUsers() {
    localStorage.setItem(USERS_KEY, JSON.stringify(users));
  }

  function saveBans() {
    localStorage.setItem(BANNED_KEY, JSON.stringify(Array.from(bannedUsers)));
  }

  // Add log entry
  function addLog(text) {
    const time = new Date().toLocaleTimeString();
    logs.push(`[${time}] ${text}`);
    if(logs.length > 50) logs.shift();
    renderLogs();
  }
  function renderLogs() {
    logsDiv.innerHTML = logs.map(l => `<div>${l}</div>`).join('');
    logsDiv.scrollTop = logsDiv.scrollHeight;
  }

  // Ban a user
  function banUser(username) {
    if(username === ADMIN_USERNAME) {
      alert("You can't ban the admin!");
      return;
    }
    bannedUsers.add(username);
    saveBans();

    if(users[username]) {
      users[username].isBanned = true;
      saveUsers();
    }
    addLog(`User "${username}" was banned.`);
    if(currentUser && currentUser.username === username) {
      showBanPopup();
      logout(false);
    }
    renderPlayersList();
  }

  // Show ban popup
  function showBanPopup() {
    banPopup.style.display = 'flex';
  }

  // Hide ban popup
  function hideBanPopup() {
    banPopup.style.display = 'none';
  }

  // Render players list in admin panel
  function renderPlayersList() {
    playersList.innerHTML = '';
    Object.keys(users).forEach(u => {
      const user = users[u];
      const div = document.createElement('div');
      div.textContent = `${u} ${user.isBanned ? 'ðŸš«' : ''} - $${user.money}`;
      div.dataset.username = u;
      if(selectedPlayerForBan === u) div.classList.add('selected');
      div.addEventListener('click', () => {
        selectedPlayerForBan = u === selectedPlayerForBan ? null : u;
        renderPlayersList();
      });
      playersList.appendChild(div);
    });
  }

  // Show/hide admin panel depending on currentUser
  function updateAdminPanel() {
    if(currentUser?.isAdmin) {
      adminPanel.style.display = 'flex';
      renderPlayersList();
    } else {
      adminPanel.style.display = 'none';
    }
  }

  // Update money display
  function updateMoneyDisplay() {
    if(currentUser) {
      moneyDisplay.textContent = `Money: $${currentUser.money}`;
    } else {
      moneyDisplay.textContent = `Money: $${getGuestMoney()}`;
    }
  }

  // Update timer display
  function updateTimerDisplay() {
    timerDisplay.textContent = `Next +1 money in: ${moneyCountdown}s`;
  }

  // Guest money stored in sessionStorage
  function getGuestMoney() {
    const val = sessionStorage.getItem('guestMoney');
    return val ? Number(val) : 0;
  }
  function setGuestMoney(val) {
    sessionStorage.setItem('guestMoney', val);
  }

  // Load current user from sessionStorage
  function loadCurrentUser() {
    const data = sessionStorage.getItem('moneyGame_currentUser');
    if(data) {
      const user = JSON.parse(data);
      // Check if banned
      if(bannedUsers.has(user.username)) {
        showBanPopup();
        logout(false);
        return null;
      }
      // Check user exists and password matches (basic)
      if(users[user.username]) {
        currentUser = {...user};
        currentUser.isAdmin = user.username === ADMIN_USERNAME;
        return currentUser;
      }
    }
    currentUser = null;
    return null;
  }

  // Save current user to sessionStorage
  function saveCurrentUser() {
    if(currentUser) {
      sessionStorage.setItem('moneyGame_currentUser', JSON.stringify(currentUser));
    } else {
      sessionStorage.removeItem('moneyGame_currentUser');
    }
  }

  // Logout function
  function logout(showAlert=true) {
    currentUser = null;
    saveCurrentUser();
    logoutBtn.style.display = 'none';
    loginBtn.style.display = 'inline-block';
    signInBtn.style.display = 'inline-block';
    updateAdminPanel();
    updateMoneyDisplay();
    if(showAlert) alert('Logged out.');
  }

  // Login flow
  async function loginUser(username, password) {
    if(!username || !password) {
      alert('Please enter username and password.');
      return;
    }
    if(bannedUsers.has(username)) {
      showBanPopup();
      return;
    }
    if(users[username] && users[username].password === password) {
      currentUser = {
        username,
        money: users[username].money || 0,
        isAdmin: username === ADMIN_USERNAME
      };
      saveCurrentUser();
      logoutBtn.style.display = 'inline-block';
      loginBtn.style.display = 'none';
      signInBtn.style.display = 'none';
      addLog(`User "${username}" logged in.`);
      updateAdminPanel();
      updateMoneyDisplay();
      closeLoginModal();
    } else {
      alert('Invalid username or password.');
    }
  }

  // Sign up flow
  async function signUpUser(username, password) {
    if(!username || !password) {
      alert('Please enter username and password.');
      return;
    }
    if(users[username]) {
      alert('Username already taken.');
      return;
    }
    if(username === ADMIN_USERNAME) {
      alert('Cannot use reserved username.');
      return;
    }
    users[username] = {
      password,
      money: 0,
      isBanned: false
    };
    saveUsers();
    addLog(`User "${username}" signed up.`);
    alert('Sign up successful! Please log in.');
    closeSignInModal();
  }

  // Open/Close modals
  function openLoginModal() {
    loginModal.style.display = 'flex';
    loginUsername.focus();
  }
  function closeLoginModal() {
    loginModal.style.display = 'none';
    loginUsername.value = '';
    loginPassword.value = '';
  }
  function openSignInModal() {
    signInModal.style.display = 'flex';
    signInUsername.focus();
  }
  function closeSignInModal() {
    signInModal.style.display = 'none';
    signInUsername.value = '';
    signInPassword.value = '';
  }

  // Cats images URLs (public domain or free images)
  const catImages = [
    "https://placekitten.com/100/100",
    "https://placekitten.com/101/100",
    "https://placekitten.com/102/100",
    "https://placekitten.com/103/100",
    "https://placekitten.com/104/100",
    "https://placekitten.com/105/100",
    "https://placekitten.com/106/100",
    "https://placekitten.com/107/100",
    "https://placekitten.com/108/100",
    "https://placekitten.com/109/100",
  ];

  // Render cats images
  function renderCats() {
    catsContainer.innerHTML = '';
    for(let i = 0; i < 10; i++) {
      const img = document.createElement('img');
      img.src = catImages[i];
      img.alt = "Cat Image";
      catsContainer.appendChild(img);
    }
  }

  // Money increment every 30 seconds
  function startMoneyTimer() {
    moneyCountdown = 30;
    updateTimerDisplay();
    if(moneyInterval) clearInterval(moneyInterval);

    moneyInterval = setInterval(() => {
      moneyCountdown--;
      if(moneyCountdown <= 0) {
        moneyCountdown = 30;
        incrementMoney();
      }
      updateTimerDisplay();
    }, 1000);
  }

  // Increment money for user or guest
  function incrementMoney() {
    if(currentUser) {
      currentUser.money++;
      users[currentUser.username].money = currentUser.money;
      saveUsers();
      updateMoneyDisplay();
      addLog(`User "${currentUser.username}" received +1 money.`);
      renderPlayersList();
    } else {
      let gm = getGuestMoney();
      gm++;
      setGuestMoney(gm);
      updateMoneyDisplay();
    }
  }

  // Ban button click
  banBtn.addEventListener('click', () => {
    if(selectedPlayerForBan) {
      if(confirm(`Are you sure you want to ban "${selectedPlayerForBan}"?`)) {
        banUser(selectedPlayerForBan);
        selectedPlayerForBan = null;
        renderPlayersList();
      }
    } else {
      alert('Select a player to ban.');
    }
  });

  // Button events
  loginBtn.addEventListener('click', openLoginModal);
  signInBtn.addEventListener('click', openSignInModal);
  logoutBtn.addEventListener('click', () => {
    logout();
  });

  loginCloseBtn.addEventListener('click', closeLoginModal);
  signInCloseBtn.addEventListener('click', closeSignInModal);

  loginSubmitBtn.addEventListener('click', () => {
    loginUser(loginUsername.value.trim(), loginPassword.value);
  });

  signInSubmitBtn.addEventListener('click', () => {
    signUpUser(signInUsername.value.trim(), signInPassword.value);
  });

  // Also close modals on clicking outside modal content
  [loginModal, signInModal].forEach(modal => {
    modal.addEventListener('click', e => {
      if(e.target === modal) {
        modal.style.display = 'none';
      }
    });
  });

  // On page load
  function init() {
    loadData();
    loadCurrentUser();
    if(currentUser) {
      logoutBtn.style.display = 'inline-block';
      loginBtn.style.display = 'none';
      signInBtn.style.display = 'none';
    } else {
      logoutBtn.style.display = 'none';
      loginBtn.style.display = 'inline-block';
      signInBtn.style.display = 'inline-block';
    }
    updateAdminPanel();
    updateMoneyDisplay();
    renderCats();
    renderLogs();
    startMoneyTimer();
  }

  init();

  // Refresh cats every 30 seconds
  setInterval(renderCats, 30000);

})();
</script>

</body>
</html>
