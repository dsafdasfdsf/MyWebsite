<!DOCTYPE html>
<html lang="en" >
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Simple Money Game</title>
  <style>
    /* Reset */
    * {
      box-sizing: border-box;
    }
    body {
      margin: 0; padding: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #fafafa;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
      color: #222;
      user-select: none;
      overflow-x: hidden;
    }
    header {
      width: 100%;
      background: white;
      padding: 14px 0;
      box-shadow: 0 2px 8px rgba(0,0,0,0.12);
      display: flex;
      justify-content: center;
      gap: 14px;
      position: sticky;
      top: 0;
      z-index: 10;
    }
    button {
      background: #4caf50;
      border: none;
      padding: 10px 18px;
      border-radius: 24px;
      color: white;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.3s ease;
      font-size: 1rem;
      box-shadow: 0 3px 8px rgb(76 175 80 / 0.4);
      display: flex;
      align-items: center;
      gap: 6px;
    }
    button:hover:not(:disabled) {
      background: #43a047;
      box-shadow: 0 5px 12px rgb(67 160 71 / 0.7);
    }
    button:disabled {
      background: #9e9e9e;
      cursor: not-allowed;
      box-shadow: none;
    }
    main {
      margin-top: 40px;
      width: 960px;
      max-width: 95vw;
      display: grid;
      grid-template-columns: 320px 1fr;
      gap: 28px;
      padding-bottom: 60px;
    }
    #gamePanel {
      background: white;
      padding: 30px 30px 36px;
      border-radius: 18px;
      box-shadow: 0 10px 25px rgb(0 0 0 / 0.05);
      display: none;
      flex-direction: column;
      align-items: center;
      animation: fadeIn 0.5s ease forwards;
    }
    #welcomeMsg {
      font-weight: 700;
      font-size: 1.3rem;
      margin-bottom: 14px;
      user-select: text;
    }
    #moneyDisplay {
      font-size: 1.6rem;
      font-weight: 700;
      margin-bottom: 14px;
      color: #4caf50;
      user-select: text;
    }
    #countdown {
      font-size: 1.1rem;
      margin-bottom: 18px;
      color: #555;
    }
    #log, #playersList, #shop {
      background: #f7fefa;
      border-radius: 14px;
      padding: 14px 16px;
      box-shadow: inset 0 0 12px rgb(76 175 80 / 0.15);
      overflow-y: auto;
      max-height: 200px;
      user-select: none;
      font-size: 0.9rem;
    }
    #log {
      margin-top: 20px;
      height: 180px;
      color: #2e7d32;
      font-weight: 500;
    }
    #log div {
      margin-bottom: 6px;
      opacity: 0;
      animation: fadeInUp 0.4s forwards;
    }
    #playersList {
      max-height: 320px;
      margin-bottom: 16px;
      font-weight: 600;
      color: #2e7d32;
      user-select: text;
    }
    #playersList div {
      padding: 8px 10px;
      border-radius: 12px;
      margin-bottom: 6px;
      background: #c8e6c9;
      box-shadow: 0 3px 8px rgb(76 175 80 / 0.3);
      cursor: default;
      transition: background 0.25s ease;
    }
    #playersList div.selected {
      background: #81c784;
      font-weight: 700;
      color: white;
      box-shadow: 0 4px 12px rgb(56 142 60 / 0.7);
    }
    #playersList div:hover:not(.selected) {
      background: #a5d6a7;
    }
    #banBtn {
      margin-top: 6px;
      background: #e53935;
      box-shadow: 0 3px 8px rgb(229 57 53 / 0.6);
      font-weight: 700;
    }
    #banBtn:hover:not(:disabled) {
      background: #b71c1c;
      box-shadow: 0 5px 15px rgb(183 28 28 / 0.8);
    }
    #banBtn:disabled {
      cursor: not-allowed;
      background: #ef9a9a;
      box-shadow: none;
    }
    #shop {
      max-height: 180px;
      font-weight: 600;
      color: #2e7d32;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    #shop button {
      background: #388e3c;
      box-shadow: 0 3px 8px rgb(56 142 60 / 0.5);
      font-weight: 700;
      font-size: 1rem;
      padding: 8px 14px;
      border-radius: 14px;
      transition: background 0.3s ease;
      width: 100%;
    }
    #shop button:hover:not(:disabled) {
      background: #2e7d32;
      box-shadow: 0 5px 15px rgb(46 115 50 / 0.8);
    }
    #shop button:disabled {
      cursor: not-allowed;
      background: #a5d6a7;
      box-shadow: none;
    }
    #cats {
      grid-column: span 2;
      margin-top: 40px;
      user-select: none;
      display: flex;
      justify-content: center;
      gap: 24px;
      flex-wrap: wrap;
    }
    #cats img {
      width: 160px;
      height: 120px;
      border-radius: 18px;
      box-shadow: 0 8px 20px rgb(0 0 0 / 0.1);
      object-fit: cover;
      transform: scale(0.95);
      animation: float 4s ease-in-out infinite;
      cursor: default;
      transition: transform 0.3s ease;
    }
    #cats img:hover {
      transform: scale(1.1) rotate(5deg);
      box-shadow: 0 12px 32px rgb(0 0 0 / 0.2);
    }
    /* Animations */
    @keyframes fadeIn {
      from {opacity: 0;}
      to {opacity: 1;}
    }
    @keyframes fadeInUp {
      from {opacity: 0; transform: translateY(8px);}
      to {opacity: 1; transform: translateY(0);}
    }
    @keyframes float {
      0%, 100% {transform: translateY(0) scale(0.95);}
      50% {transform: translateY(-12px) scale(1);}
    }
    
    /* Popup styling */
    #popup {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(0);
      background: #e53935;
      color: white;
      padding: 24px 36px;
      border-radius: 18px;
      box-shadow: 0 8px 20px rgb(229 57 53 / 0.9);
      font-weight: 700;
      font-size: 1.4rem;
      z-index: 9999;
      transition: transform 0.3s ease;
      user-select: none;
      text-align: center;
      max-width: 320px;
    }
    #popup.show {
      transform: translate(-50%, -50%) scale(1);
    }
    #popup button {
      margin-top: 16px;
      background: white;
      color: #e53935;
      padding: 8px 18px;
      border-radius: 12px;
      font-weight: 700;
      cursor: pointer;
      box-shadow: 0 3px 10px rgb(229 57 53 / 0.6);
      transition: background 0.3s ease;
    }
    #popup button:hover {
      background: #f44336;
      color: white;
    }
  </style>
</head>
<body>
  <header>
    <button id="loginBtn">Log In</button>
    <button id="signupBtn">Sign Up</button>
    <button id="logoutBtn" style="display:none; background:#e53935;">Log Out</button>
  </header>

  <main>
    <section id="leftPanel" style="display:flex; flex-direction: column;">
      <div id="welcomeMsg" style="font-weight:700; font-size:1.2rem; margin-bottom:8px;"></div>
      <div id="moneyDisplay" style="font-size:1.4rem; color:#4caf50; margin-bottom:6px;"></div>
      <div id="countdown" style="color:#555; margin-bottom:12px;"></div>

      <div id="playersList" title="Player List" style="flex-grow:1; overflow-y:auto; border-radius:12px; background:#f7fefa; padding:12px; box-shadow: inset 0 0 12px rgb(76 175 80 / 0.15); max-height:400px;"></div>
      <button id="banBtn" disabled style="display:none;">Ban Player</button>

      <div id="log" style="margin-top: 14px; max-height:200px; overflow-y:auto;"></div>
    </section>

    <section id="gamePanel" style="display:none; flex-direction: column;">
      <div id="shopTitle" style="font-weight:700; font-size:1.2rem; margin-bottom:8px; color:#2e7d32;">Shop</div>
      <div id="shop" style="display:flex; flex-direction: column; gap:10px;">
        <button data-item="Hat" data-price="10">Buy Hat - $10</button>
        <button data-item="Sword" data-price="25">Buy Sword - $25</button>
        <button data-item="Shield" data-price="40">Buy Shield - $40</button>
      </div>
    </section>

    <section id="cats" aria-label="Cat pictures">
      <!-- Cats will appear here -->
    </section>
  </main>

  <!-- Popup -->
  <div id="popup">
    <div>Error: This user is banned</div>
    <button id="popupClose">Close</button>
  </div>

<script>
(() => {
  // Data store & state
  const usersKey = 'moneyGameUsers_v2';
  const bannedKey = 'moneyGameBanned_v2';

  let users = JSON.parse(localStorage.getItem(usersKey)) || {};
  let bannedPlayers = JSON.parse(localStorage.getItem(bannedKey)) || [];
  let currentUser = null;
  let money = 0;
  let nextSecond = 30;
  let moneyInterval = null;
  let secondTimer = null;
  let selectedPlayer = null;

  // Cached DOM
  const loginBtn = document.getElementById('loginBtn');
  const signupBtn = document.getElementById('signupBtn');
  const logoutBtn = document.getElementById('logoutBtn');
  const banBtn = document.getElementById('banBtn');
  const welcomeMsg = document.getElementById('welcomeMsg');
  const moneyDisplay = document.getElementById('moneyDisplay');
  const countdown = document.getElementById('countdown');
  const playersList = document.getElementById('playersList');
  const logDiv = document.getElementById('log');
  const gamePanel = document.getElementById('gamePanel');
  const shop = document.getElementById('shop');
  const popup = document.getElementById('popup');
  const popupClose = document.getElementById('popupClose');
  const catsSection = document.getElementById('cats');

  // Predefined cats URLs
  const catPics = [
    'https://cataas.com/cat/cute/says/Hi%20there!',
    'https://cataas.com/cat/sleepy',
    'https://cataas.com/cat/funny',
    'https://cataas.com/cat/smile',
    'https://cataas.com/cat/angry',
    'https://cataas.com/cat/cat',
    'https://cataas.com/cat/whiskers',
    'https://cataas.com/cat/meow',
    'https://cataas.com/cat/eyes',
    'https://cataas.com/cat/happy',
  ];

  // Initialize admin account
  if (!users.admin) {
    users.admin = { password: 'admin', money: 0, items: [] };
    saveStorage();
  }

  // Save data
  function saveStorage() {
    localStorage.setItem(usersKey, JSON.stringify(users));
    localStorage.setItem(bannedKey, JSON.stringify(bannedPlayers));
  }

  // Logging utility
  let logs = [];
  function log(msg) {
    const timestamp = new Date().toLocaleTimeString();
    logs.push(`[${timestamp}] ${msg}`);
    if (logs.length > 50) logs.shift(); // keep last 50 logs
    renderLogs();
  }
  function renderLogs() {
    logDiv.innerHTML = '';
    logs.forEach(text => {
      const d = document.createElement('div');
      d.textContent = text;
      logDiv.appendChild(d);
    });
    logDiv.scrollTop = logDiv.scrollHeight;
  }

  // Money and countdown update
  function updateMoney() {
    moneyDisplay.textContent = `Money: $${money}`;
  }
  function updateCountdown() {
    countdown.textContent = `Next $1 in: ${nextSecond}s`;
  }

  // Start timers for earning money
  function startMoneyTimers() {
    updateCountdown();
    if (moneyInterval) clearInterval(moneyInterval);
    if (secondTimer) clearInterval(secondTimer);

    secondTimer = setInterval(() => {
      nextSecond--;
      if (nextSecond <= 0) nextSecond = 30;
      updateCountdown();
    }, 1000);

    moneyInterval = setInterval(() => {
      money++;
      users[currentUser].money = money;
      saveStorage();
      updateMoney();
      log(`You earned $1! Total: $${money}`);
      nextSecond = 30;
      updateCountdown();
    }, 30000);
  }

  // Render players list
  function renderPlayersList() {
    playersList.innerHTML = '';
    Object.keys(users).forEach(user => {
      if (bannedPlayers.includes(user)) return; // skip banned
      const div = document.createElement('div');
      div.textContent = user + (user === currentUser ? " (You)" : "");
      if (user === selectedPlayer) div.classList.add('selected');
      div.title = users[user].items.length > 0 ? `Items: ${users[user].items.join(', ')}` : "No items";
      if (currentUser === 'admin') {
        div.style.cursor = 'pointer';
        div.onclick = () => {
          if (user === currentUser) return; // can't select self
          selectedPlayer = user;
          renderPlayersList();
          banBtn.disabled = !selectedPlayer;
        };
      }
      playersList.appendChild(div);
    });
  }

  // Ban player function
  function banSelectedPlayer() {
    if (!selectedPlayer) return;
    if (!confirm(`Ban player "${selectedPlayer}"? They will be logged out and banned.`)) return;

    bannedPlayers.push(selectedPlayer);
    delete users[selectedPlayer];
    saveStorage();
    log(`Player "${selectedPlayer}" was banned by admin.`);
    selectedPlayer = null;
    banBtn.disabled = true;
    renderPlayersList();

    // Force logout banned user if online
    if (currentUser === selectedPlayer) {
      logout();
      showPopup('Error: This user is banned');
    }
  }

  // Show popup
  function showPopup(message) {
    popup.querySelector('div').textContent = message;
    popup.classList.add('show');
  }
  popupClose.onclick = () => {
    popup.classList.remove('show');
  };

  // Login/signup form popup simplified to prompt dialogs
  async function handleLogin() {
    let user = prompt('Enter username:');
    if (!user) return;
    if (bannedPlayers.includes(user)) {
      showPopup('Error: This user is banned');
      return;
    }
    let pass = prompt('Enter password:');
    if (!pass) return;
    if (!users[user]) {
      alert('User does not exist.');
      return;
    }
    if (users[user].password !== pass) {
      alert('Incorrect password.');
      return;
    }
    currentUser = user;
    startGame();
  }

  async function handleSignup() {
    let user = prompt('Choose username:');
    if (!user) return;
    if (users[user]) {
      alert('Username taken.');
      return;
    }
    if (bannedPlayers.includes(user)) {
      showPopup('Error: This user is banned');
      return;
    }
    let pass = prompt('Choose password:');
    if (!pass) return;
    users[user] = { password: pass, money: 0, items: [] };
    saveStorage();
    alert('Sign up successful. Please log in.');
  }

  // Start the game UI after login
  function startGame() {
    loginBtn.style.display = 'none';
    signupBtn.style.display = 'none';
    logoutBtn.style.display = 'inline-flex';
    gamePanel.style.display = 'flex';
    welcomeMsg.textContent = `Welcome, ${currentUser}!`;
    money = users[currentUser].money || 0;
    updateMoney();
    renderPlayersList();
    banBtn.disabled = true;

    if (currentUser === 'admin') {
      banBtn.style.display = 'block';
      playersList.title = 'Click a player to select and ban (admin only)';
    } else {
      banBtn.style.display = 'none';
      playersList.title = 'Player List';
    }

    startMoneyTimers();
    logs = [];
    log(`Logged in as "${currentUser}".`);

    // Reset selected player
    selectedPlayer = null;

    // Shop buy handlers
    shop.querySelectorAll('button').forEach(btn => {
      btn.onclick = () => {
        const price = Number(btn.dataset.price);
        const item = btn.dataset.item;
        if (money < price) {
          log(`Not enough money to buy ${item}.`);
          return;
        }
        money -= price;
        users[currentUser].money = money;
        users[currentUser].items.push(item);
        saveStorage();
        updateMoney();
        log(`Bought ${item} for $${price}.`);
      };
    });
  }

  // Logout function
  function logout() {
    currentUser = null;
    money = 0;
    nextSecond = 30;
    clearInterval(moneyInterval);
    clearInterval(secondTimer);
    moneyInterval = null;
    secondTimer = null;
    gamePanel.style.display = 'none';
    loginBtn.style.display = 'inline-flex';
    signupBtn.style.display = 'inline-flex';
    logoutBtn.style.display = 'none';
    welcomeMsg.textContent = '';
    moneyDisplay.textContent = '';
    countdown.textContent = '';
    playersList.innerHTML = '';
    logDiv.innerHTML = '';
    banBtn.disabled = true;
    banBtn.style.display = 'none';
  }

  // Ban button click
  banBtn.onclick = () => {
    banSelectedPlayer();
  };

  // Button handlers
  loginBtn.onclick = handleLogin;
  signupBtn.onclick = handleSignup;
  logoutBtn.onclick = logout;

  // Show random cat pics every 10 seconds
  function showCats() {
    catsSection.innerHTML = '';
    for(let i=0; i<3; i++){
      const img = document.createElement('img');
      img.src = catPics[Math.floor(Math.random() * catPics.length)] + `?t=${Date.now()}`;
      img.alt = "Cute cat picture";
      catsSection.appendChild(img);
    }
  }
  showCats();
  setInterval(showCats, 10000);

})();
</script>

</body>
</html>
